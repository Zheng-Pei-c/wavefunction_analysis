

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>wavefunction_analysis.utils.sec_mole &mdash; wavefunction_analysis  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            wavefunction_analysis
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../wavefunction_analysis.html">wavefunction_analysis package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">wavefunction_analysis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">wavefunction_analysis.utils.sec_mole</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for wavefunction_analysis.utils.sec_mole</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span><span class="w"> </span><span class="nn">wavefunction_analysis</span><span class="w"> </span><span class="kn">import</span> <span class="n">sys</span><span class="p">,</span> <span class="n">np</span>

<div class="viewcode-block" id="read_geometry">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.read_geometry">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_geometry</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">probe</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">probe</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># all</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">probe</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="c1"># probe only</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">!=</span><span class="s1">&#39;ag&#39;</span><span class="p">:</span>
                        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">probe</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="c1"># metal only</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;ag&#39;</span><span class="p">:</span>
                        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">geometry</span></div>



<div class="viewcode-block" id="read_geometries_standard">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.read_geometries_standard">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_geometries_standard</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">screen</span><span class="o">=</span><span class="s1">&#39;User input: 2 of 2&#39;</span><span class="p">):</span>
    <span class="n">geometries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">screen</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">screen</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">geometries</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;Standard Nuclear Orientation (Angstroms)&#39;</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">geometry</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
                <span class="n">dash</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
                <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">line</span> <span class="o">!=</span> <span class="n">dash</span><span class="p">:</span>
                    <span class="n">geometry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">8</span><span class="p">:])</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>

                <span class="n">geometries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">geometries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">geometries</span> <span class="o">=</span> <span class="n">geometries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">geometries</span></div>



<div class="viewcode-block" id="read_symbols_coords">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.read_symbols_coords">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">read_symbols_coords</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">probe</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">geometry</span> <span class="o">=</span> <span class="n">read_geometry</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">probe</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">get_symbols_coords</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_symbols_coords">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.get_symbols_coords">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_symbols_coords</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">string</span><span class="p">:</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">geometry</span><span class="p">]</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="p">[])</span> <span class="c1"># convert to 1d list</span>

    <span class="n">natom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">symbols</span><span class="p">,</span> <span class="n">coords</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">natom</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natom</span><span class="p">):</span>
        <span class="n">symbols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">atom</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">coords</span><span class="p">[</span><span class="n">atom</span><span class="p">,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">atom</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="p">]</span> <span class="c1"># convert to float automatically by np</span>

    <span class="k">return</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">coords</span></div>



<div class="viewcode-block" id="write_geometry">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.write_geometry">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_geometry</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">open_file_method</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;stdout&#39;</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">open_file_method</span><span class="p">)</span>

    <span class="c1">#with open(infile, open_file_method) as f:</span>
    <span class="k">if</span> <span class="n">infile</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.xyz&#39;</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">energy</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">energy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%2s</span><span class="s1">   &#39;</span> <span class="o">%</span> <span class="n">geometry</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">atom</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">geometry</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">atom</span><span class="o">+</span><span class="n">x</span><span class="p">])</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;stdout&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="write_symbols_coords">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.write_symbols_coords">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_symbols_coords</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">symbols</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">open_file_method</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;stdout&#39;</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">open_file_method</span><span class="p">)</span>

    <span class="c1">#with open(infile, open_file_method) as f:</span>
    <span class="k">if</span> <span class="n">infile</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.xyz&#39;</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">energy</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%f</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">energy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%2s</span><span class="s1">   &#39;</span> <span class="o">%</span> <span class="n">symbols</span><span class="p">[</span><span class="n">atom</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%14.8f</span><span class="s1"> &#39;</span> <span class="o">%</span> <span class="n">coords</span><span class="p">[</span><span class="n">atom</span><span class="p">,</span> <span class="n">x</span><span class="p">])</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;stdout&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">infile</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="switch_atoms">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.switch_atoms">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">switch_atoms</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">atom_list</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">atom_list</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;atom_list has </span><span class="si">%2d</span><span class="s1"> duplicates&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atom_list</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">atom_list</span><span class="p">))))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atom_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span><span class="o">//</span><span class="mi">4</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;atom_list has more elements&#39;</span><span class="p">)</span>

    <span class="n">geometry_new</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">atom_list</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">geometry_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">geometry</span><span class="p">[</span><span class="mi">4</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="n">x</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">geometry_new</span></div>



<div class="viewcode-block" id="write_mol_info">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.write_mol_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_mol_info</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">multiplicity</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">open_file_method</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span>
                   <span class="n">itype</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    itype: 0 normal job; 1 second job; 2 fragment</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">open_file_method</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">itype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;@@@</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">itype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;---</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;$molecule</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">charge</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">itype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;read</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="write_mol_info_geometry">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.write_mol_info_geometry">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_mol_info_geometry</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="n">multiplicity</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span>
                            <span class="n">frgm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">frgm</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">write_mol_info</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">,</span> <span class="s1">&#39;w+&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">write_geometry</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;geometry&#39;</span><span class="p">),</span> <span class="n">open_file_method</span><span class="o">=</span><span class="s1">&#39;a+&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s1">&#39;symbols&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s1">&#39;coords&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">write_symbols_coords</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;symbols&#39;</span><span class="p">),</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;coords&#39;</span><span class="p">),</span> <span class="n">open_file_method</span><span class="o">=</span><span class="s1">&#39;a+&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;need geometry info&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;$end</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="write_rem_info">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.write_rem_info">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">write_rem_info</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;pbe0&#39;</span><span class="p">,</span> <span class="n">basis</span><span class="o">=</span><span class="s1">&#39;6-31g&#39;</span><span class="p">,</span> <span class="n">open_file_method</span><span class="o">=</span><span class="s1">&#39;a+&#39;</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">open_file_method</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;$rem</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;method         </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;basis          </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">basis</span><span class="p">)</span>
        <span class="c1">#f.write(&#39;purecart       2222\n&#39;)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;sym_ignore     true</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;thresh         14</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;$end</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_rotation_matrix">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.get_rotation_matrix">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_rotation_matrix</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    [cos -sin]</span>
<span class="sd">    [sin  cos]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#i, j = 0, 0</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="s1">&#39;z&#39;</span> <span class="ow">or</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>

    <span class="n">rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>

    <span class="n">rot</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rot</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">cos</span>
    <span class="n">rot</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">sin</span>
    <span class="n">rot</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sin</span>

    <span class="k">return</span> <span class="n">rot</span></div>



<div class="viewcode-block" id="get_moment_of_inertia">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.get_moment_of_inertia">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_moment_of_inertia</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">fix_sign</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;make sure to use coordinates in bohr&quot;&quot;&quot;</span>
    <span class="c1"># weights is charges or masses</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">get_molecular_center</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span> <span class="o">-</span> <span class="n">center</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;i,ix,iy-&gt;xy&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">U</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span> <span class="o">-</span> <span class="n">U</span>

    <span class="c1"># explicit loop over atoms</span>
    <span class="c1">#U = np.zeros((3,3))</span>
    <span class="c1">#for i in range(len(weights)):</span>
    <span class="c1">#    m = weights[i]</span>
    <span class="c1">#    x, y, z = coords[i]</span>

    <span class="c1">#    U[0,0] += m * (y*y+z*z)</span>
    <span class="c1">#    U[1,1] += m * (x*x+z*z)</span>
    <span class="c1">#    U[2,2] += m * (x*x+y*y)</span>
    <span class="c1">#    U[1,0] -= m * x*y</span>
    <span class="c1">#    U[2,0] -= m * x*z</span>
    <span class="c1">#    U[2,1] -= m * y*z</span>

    <span class="c1">#U[0,1] = U[1,0]</span>
    <span class="c1">#U[0,2] = U[2,0]</span>
    <span class="c1">#U[1,2] = U[2,1]</span>

    <span class="k">if</span> <span class="n">fix_sign</span><span class="p">:</span>
        <span class="n">d</span><span class="p">,</span> <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span><span class="n">i</span><span class="p">]):</span> <span class="n">U</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span>

        <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span>
            <span class="c1">#if abs(d[2] - d[0]) &lt; 1e-6:</span>
            <span class="c1">#    u *= -1.</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">U</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">U</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span>

    <span class="k">return</span> <span class="n">U</span></div>



<div class="viewcode-block" id="get_charge_or_mass">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.get_charge_or_mass">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_charge_or_mass</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">isotope_avg</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">pyscf.data.elements</span><span class="w"> </span><span class="kn">import</span> <span class="n">charge</span><span class="p">,</span> <span class="n">MASSES</span><span class="p">,</span> <span class="n">ISOTOPE_MAIN</span>
    <span class="n">chgs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)):</span>
        <span class="n">chgs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">charge</span><span class="p">(</span><span class="n">symbols</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">itype</span> <span class="o">==</span> <span class="s1">&#39;mass&#39;</span><span class="p">:</span>
        <span class="n">mass_table</span> <span class="o">=</span> <span class="n">MASSES</span> <span class="k">if</span> <span class="n">isotope_avg</span> <span class="k">else</span> <span class="n">ISOTOPE_MAIN</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">symbols</span><span class="p">)):</span>
            <span class="n">mass</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mass_table</span><span class="p">[</span><span class="n">chgs</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
        <span class="n">chgs</span> <span class="o">=</span> <span class="n">mass</span>

    <span class="k">return</span> <span class="n">chgs</span></div>



<div class="viewcode-block" id="get_molecular_center">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.get_molecular_center">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_molecular_center</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">isotope_avg</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># weights is charges or masses</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># atom symbols</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">get_charge_or_mass</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">itype</span><span class="p">,</span> <span class="n">isotope_avg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;z,zx-&gt;x&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span></div>



<div class="viewcode-block" id="get_center_property">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.get_center_property">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">get_center_property</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">props</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">isotope_avg</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># weights is charges or masses</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span> <span class="c1"># atom symbols</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">get_charge_or_mass</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">itype</span><span class="p">,</span> <span class="n">isotope_avg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;z,z...-&gt;...&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">props</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span></div>



<div class="viewcode-block" id="translate_molecule">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.translate_molecule">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">translate_molecule</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="s1">&#39;charge&#39;</span><span class="p">,</span> <span class="n">isotope_avg</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># default origin is the center of charges/masses of the molecule</span>
    <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">get_charge_or_mass</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">itype</span><span class="p">,</span> <span class="n">isotope_avg</span><span class="p">)</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">get_molecular_center</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">coords</span> <span class="o">-</span> <span class="n">origin</span><span class="p">),</span> <span class="n">weights</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">coords</span> <span class="o">-</span> <span class="n">origin</span><span class="p">)</span></div>



<div class="viewcode-block" id="align_principal_axes">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.align_principal_axes">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">align_principal_axes</span><span class="p">(</span><span class="n">charges</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">get_moment_of_inertia</span><span class="p">(</span><span class="n">charges</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;nx,xy-&gt;ny&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span></div>



<div class="viewcode-block" id="standard_orientation">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.standard_orientation">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">standard_orientation</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="c1"># translate to center of charge</span>
    <span class="n">coords</span><span class="p">,</span> <span class="n">chgs</span> <span class="o">=</span> <span class="n">translate_molecule</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="s1">&#39;charge&#39;</span><span class="p">)</span>
    <span class="n">coords</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_standard_orientation</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">align_principal_axes</span><span class="p">(</span><span class="n">chgs</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coords</span></div>



<div class="viewcode-block" id="standard_orientation2">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.standard_orientation2">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">standard_orientation2</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;we need the intermediate translation and principal matrices&quot;&quot;&quot;</span>
    <span class="c1"># translate to center of charge</span>
    <span class="n">chgs</span> <span class="o">=</span> <span class="n">get_charge_or_mass</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">itype</span><span class="o">=</span><span class="s1">&#39;charge&#39;</span><span class="p">)</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">get_molecular_center</span><span class="p">(</span><span class="n">chgs</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>

    <span class="n">coords</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">_standard_orientation</span><span class="p">((</span><span class="n">coords</span><span class="o">-</span><span class="n">origin</span><span class="p">),</span> <span class="p">(</span><span class="n">var</span><span class="o">-</span><span class="n">origin</span><span class="p">),</span> <span class="n">tol</span><span class="p">)</span>
    <span class="n">coords</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_standard_orientation</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>

    <span class="n">U</span> <span class="o">=</span> <span class="n">get_moment_of_inertia</span><span class="p">(</span><span class="n">chgs</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;nx,xy-&gt;ny&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...x,xy-&gt;...y&#39;</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">var</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">_standard_orientation</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="nb">float</span><span class="p">(</span><span class="n">tol</span><span class="p">))</span> <span class="c1">#1e-tol</span>

    <span class="c1"># var is a geometry-dependent object (vector/matrix)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">rotation</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">coords</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">r</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mf">0.</span><span class="p">:</span> <span class="n">theta</span> <span class="o">*=</span> <span class="o">-</span><span class="mf">1.</span>
        <span class="n">rot</span> <span class="o">=</span> <span class="n">get_rotation_matrix</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;nx,xy-&gt;ny&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;...x,xy-&gt;...y&#39;</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">rot</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">var</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">kernel</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">coords</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">rotation</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span> <span class="c1"># rotate to X axis</span>

        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">coords</span><span class="p">,</span> <span class="n">var</span> <span class="o">=</span> <span class="n">rotation</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span> <span class="c1"># rotate to +Z axis</span>

        <span class="k">if</span> <span class="n">level</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">natoms</span><span class="p">):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span> <span class="c1"># rotate second atom to +X semi-plane</span>
                    <span class="k">return</span> <span class="n">rotation</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">var</span>


    <span class="n">natoms</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">natoms</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span> <span class="ow">or</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kernel</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kernel</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">z</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kernel</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">var</span>


<div class="viewcode-block" id="cal_dihedral_angle">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.cal_dihedral_angle">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">cal_dihedral_angle</span><span class="p">(</span><span class="n">vectors</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">vectors</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vectors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vectors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vectors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vectors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">vectors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vectors</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v1</span><span class="p">,</span><span class="n">v2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v1</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span></div>



<div class="viewcode-block" id="rotate_molecule">
<a class="viewcode-back" href="../../../wavefunction_analysis.utils.html#wavefunction_analysis.utils.sec_mole.rotate_molecule">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">rotate_molecule</span><span class="p">(</span><span class="n">coords0</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">theta</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.spatial.transform</span><span class="w"> </span><span class="kn">import</span> <span class="n">Rotation</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span> <span class="c1"># axis lies in the molecule</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="n">coords0</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">coords0</span><span class="p">[</span><span class="n">axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">axis</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">-</span> <span class="n">v1</span>
        <span class="n">axis</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">axis</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">])</span>
        <span class="n">align</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">align_vectors</span><span class="p">(</span><span class="n">axis</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">z</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;nx,xy-&gt;ny&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">coords0</span><span class="o">-</span><span class="n">v2</span><span class="p">),</span> <span class="n">align</span><span class="p">)</span>

        <span class="n">rotation</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_euler</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span><span class="o">.</span><span class="n">as_matrix</span><span class="p">()</span> <span class="c1"># xyz is case sensitive</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;nx,xy-&gt;ny&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;nx,yx-&gt;ny&#39;</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">align</span><span class="p">)</span> <span class="o">+</span> <span class="n">v2</span> <span class="c1"># reverse alignment</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">axis</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="c1"># make sure the axis is normalized</span>
        <span class="c1">## same as scipy library function</span>
        <span class="c1">#cos, sin = np.cos(theta), np.sin(theta)</span>
        <span class="c1">#coords = coords0 * cos - np.cross(coords0, axis*sin) + np.einsum(&#39;nx,x,y-&gt;ny&#39;, coords0, axis, axis*(1.-cos))</span>

        <span class="n">rotation</span> <span class="o">=</span> <span class="n">Rotation</span><span class="o">.</span><span class="n">from_rotvec</span><span class="p">(</span><span class="n">theta</span><span class="o">*</span><span class="n">axis</span><span class="p">)</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">rotation</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">coords0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">coords</span></div>




<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">wavefunction_analysis.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">print_matrix</span><span class="p">,</span> <span class="n">convert_units</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">wavefunction_analysis.utils.pyscf_parser</span><span class="w"> </span><span class="kn">import</span> <span class="n">build_atom</span>

    <span class="n">xyzfile</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">symbols</span><span class="p">,</span> <span class="n">coords</span> <span class="o">=</span> <span class="n">read_symbols_coords</span><span class="p">(</span><span class="n">xyzfile</span><span class="p">)</span>
    <span class="n">atom</span> <span class="o">=</span> <span class="n">build_atom</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>

    <span class="n">weights</span> <span class="o">=</span> <span class="n">get_charge_or_mass</span><span class="p">(</span><span class="n">symbols</span><span class="p">,</span> <span class="s1">&#39;mass&#39;</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">convert_units</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;bohr&#39;</span><span class="p">)</span>
    <span class="n">inertia</span> <span class="o">=</span> <span class="n">get_moment_of_inertia</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
    <span class="n">print_matrix</span><span class="p">(</span><span class="s1">&#39;inertia:&#39;</span><span class="p">,</span> <span class="n">inertia</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Zheng Pei.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>